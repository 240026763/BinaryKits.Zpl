using BinaryKits.Utility.ZPLUtility;
using BinaryKits.Utility.ZPLUtility.Elements;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Collections.Generic;
using System.Diagnostics;
using System.Drawing;

namespace ZPLUtility.UnitTest
{
    [TestClass]
    public class DownloadTest
    {
        private Bitmap GetTestBitmap()
        {
            using var font = new Font("Arial", 10);

            var bitmap = new Bitmap(100, 20);

            using var canvas = Graphics.FromImage(bitmap);
            canvas.Clear(Color.White);
            canvas.DrawLine(Pens.Black, 10, 10, 90, 10);
            canvas.DrawString("ABC 1234 TEST", font, Brushes.Black, 10, 0);

            return bitmap;

        }

        [TestMethod]
        public void DownloadGraphics()
        {
            using var bitmap = GetTestBitmap();

            var elements = new List<ZPLElementBase>
            {
                new ZPLGraphicBox(0, 0, 100, 100, 4),
                new ZPLDownloadGraphics('R', "SAMPLE", "GRC", bitmap),
                new ZPLRecallGraphic(100, 100, 'R', "SAMPLE", "GRC")
            };

            var renderEngine = new ZPLEngine(elements);
            var output = renderEngine.ToZPLString(new ZPLRenderOptions { AddEmptyLineBeforeElementStart = true, TargetPrintDPI = 200, SourcePrintDPI = 200 });

            Debug.WriteLine(output);
            Assert.IsNotNull(output);
            Assert.AreEqual("^XA\n^LH0,0\n^CI28\n\n^FO0,0\n^GB100,100,4,B,0^FS\n\n~DGR:SAMPLE.GRC,260,13,\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n000083F078010E1C081FDFC780\n00018208840311221802100840\n00014209040711021802100820\n00024201000101022802100800\n000223F10001030C08021F8700\n000222090001020248021001C0\n0007E209000104028802100020\n003FFFFFFFFFFFFFFFFFFFE820\n00081208840110220802100C60\n00081BF078013F1C08021FC780\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n00000000000000000000000000\n\n^FO100,100\n^XGR:SAMPLE.GRC,1,1,\n^XZ", output);
        }

        [TestMethod]
        public void DownloadObjets()
        {
            using var bitmap = GetTestBitmap();

            var elements = new List<ZPLElementBase>
            {
                new ZPLGraphicBox(0, 0, 100, 100, 4),
                new ZPLDownloadObjects('R', "SAMPLE.PNG", bitmap),
                new ZPLImageMove(100, 100, 'R', "SAMPLE", "PNG")
            };

            var renderEngine = new ZPLEngine(elements);
            var output = renderEngine.ToZPLString(new ZPLRenderOptions { AddEmptyLineBeforeElementStart = true, TargetPrintDPI = 300, SourcePrintDPI = 200 });

            Debug.WriteLine(output);
            Assert.IsNotNull(output);
            Assert.AreEqual("^XA\n^LH0,0\n^CI28\n\n^FO0,0\n^GB150,150,6,B,0^FS\n\n~DYR:SAMPLE.PNG,P,P,2550,,89504E470D0A1A0A0000000D49484452000000960000001E0806000000CEE2E757000000017352474200AECE1CE90000000467414D410000B18F0BFC6105000000097048597300000EC300000EC301C76FA8640000098B49444154785EED5AFD4F5BD719F69F914DFBA1523521B5FDC162285A3A4D9025191ED46C65B9B80402F900C50908ECCC345028C6E91C0A24B622F0F0905554C89CECB6415A1395F2E1A2184AD53424A238484968E4C4D3241C55C25290FC03CAB3F7DE6BE37BED7BB1697CA56EBA8FF42AD1F5F97ADFF39CF7E31C74D0A021FF6035626950031AB134A8028D581A54817AC48AAD4C606AC409867162646A152BB1C40F62C456B03A350227C3A0918491953ED85DB710E29A0BBD5288AF03D100267ADBD126E9D34A320676318C48A269EEE06609E1966B149FF44E201005D6E3C22F3C32D6DC4822A3632C4CC38CC165E7D6925C571BDAE5C614831F9FA5F19D6095ECC641517739A179ED5E04420178ED39B46F1B41EFC40A6899109699B4891D7D32EDFBD845DC4A1A9AD64FEB5283585B249B78C49EC7E009030A0A0C38313803F6918C25C930418F0506DD1EFCA6703F8A2B32175D517C0CB535442E76198B918D14B968E322773F07EBE94167C349D48BFA56961D417951235A3EB88E712257CA40D910C3466411CBAC1D1DFB8EC05CEE848FF8F17893FB8D1B218AF0D420AE759C80A9844115376745159812134E745CC3E01789B968D39FDD9D41D06E43D3C97A9426F529AD424DAD1D66CF32BE5C13E92242ECBB117CFAFE51E87506B47B823C09652147AC8A62EC2F7C1D7BC89EAF4BEC49C4EABA84C06D1F5A0F1CC4FE9FBD81A272066595C9DFD34442AC944DFA6A6A71ACB822D5AEB20C4C79118EB57C80BE716A431D36A2AA118BDB853002CE4EB84D06D86C0698DCD7E194B3104FAC1E2296013D0A468C069CF0984DD0E96C3CB938CFC583BC016B6FA4EF06DA2869DFCDC741847D069E5C25E4B9E6E89BCCD03208F106B4E97428D0E9C9F862627123CC618C29818D4865A341394322BA4C9F6D442E5B6A2E5E2F37E965C370C69A6D99BA88101A636037EE91D52B2B76B2E7E663DA161F9CE50D6890E8950D299B98CC1EE93E6E8F59C41FB46D9BA8120A63DFD35ABC683FF7218E9F3A87597F23FE78A417A6F669DE9092539A03B1E28F58DCB8D04527D80637BF1909B76C3F8E0BCC1118ED414CDC7D26092D5BCFFF4D3A5FC7F099C368AA37C34203DF538C3DDCE15FE509DCDB6E4255E541988C46FCF6E765382CDE80D8039AF6125A4FD9F04ECB086669ADFC90F127A4871F7D15563455B8718DBE3F8D91C75A7B8820AD774DE26517B0E0BB08A3CE847EDFD7F84A6C8C44E8B43BAAF0E69BBFCEEEB1E4A006B1625FE16B5F3F4C3A23CE0F05302D35343FEE37C367D0633B85824B214C3EE095CA3FB1E24F16C8CE46D4BD7719757D7E446933CCA527F176451FFCA4E813F1FEE648AC19EF87301479E19FF91E91ADFF903237F0F7CA2AFCA5B415A40B045DC4E026896265A217ACB7973F65AB3B106BF3E93D84AF59D065AD435D53039C5E076A7F5523DD8064CE347A332DFFE0FEC779320B1C59362CBE3E8DC0D079196251B80905B14CDECCD2751ABFABACD9D1268A509958177D7430326C4D4DB87CFAE62898B11016C32A112BBACC5264D0C1E2E6DCE67DFA22133E92C881589C27B9EEEB84812C11E42CB16D20072CBB0A73CAD88C52EE34378730FD1BDDF50670B3E7462CC5B0CE871B3F851B1BFC144287B3D844116A108B5F9B100A6D7616C49D5C906F6245F060F2235C2AD0E3AF83372861E7D81BC577232DE897BA4A01BC21B225EF6FA0CC44273849AC1F88ACB71D683C49A7A8ED2638EACA1CA25D612B1EE7C9B549FFC677B901B1F01C39B2121CAF6AC2512B8B6FB82572F54B12A22AB2AEF82D1C3EFC6E46F21E5B19C5D4C77D94C3CC62EA8BABB8A92AB1B227EF922A8FF7A69F933735A29EA9C4DED254BB56BB8B279AE0A424C82FB17857FF713F8C051678FF796FBB548EDDF1E2CAE536EC310EC317584BE54339108B29DD8B3F18DF819E8CFEE9D23A62C964D9E246B933406502D94C182D3FD805B1B8DCECEE0455AC946C1B9B2FC07A551C2213D88958C91CE5EA25F8862EA39398B0429B98CD8B2B4215621164AE4E4AF7FE02070FEEA31C97C5808FC5E45CA22A1494CF2FB17857EFB64047318F15C73C258577324412E995D44F8858426833E45CC16584C2E45C9D3E742675C9C5264AC88958BB0D85F210AA571DE92248813A552147D328EE78EB70EE4FBF84AEA004FB7E2FBAEF10DDAF949FBB02EF9D842BCBC588E99554E42170DF8D36D3059C6CFC04B7A9C90F42CBFC20870D4856913D276AC9035979524DDE9756A672484FDE27EFCD50015D847EEF3FE0995EE70FC8D6FF08B162E145841658B02C0B5F77352C355544AE318CCC85B9F4E4C7132B1289F0830A324EE2417775210EBD9262B19CBC72A801D5DD3EA19FAF1B8E06864A6B3D980607BAC9A5A6C64C8A0B03D646DA0C3DEAB9369E21B01E33AA0BAB50B6AF994E3E2996D1E725643C39FE011C28AC26D2B0181A97B6191F7290E7D1A3F0553D5E5568232F525D2CEF5BF9535FD76A45B32BD126279B28C84E7D73D04B4E22A10544D6EE830D3EC6DAB3E7D2309F009FEA9C3B4D8EC3865EF2C45FBE0CB1B849E588A3C9FF97B094B4B3C30EE80C3E78885CB20E94F794A90BE1972296D863F906849357562FF24619C27DB7A379DF6B30BE9648FA5CD94F27E7661BEACBA033DA611D108DED6A86953948CAEB7128ADEF8FF728244A277B37279E5F9B91D66604631D802BF19DD78539009DDE8C06C790BCA7FDC979ACAB58B8D203E39E22BC651B45AF24AB1710996EC7DFEC47A838F3E3CAC2138E7CF9C8B16278B270057EAA8CDEBB2CCA9F32C07D0FE1466B29DADFAE80D11FC5C2125701B513D3F538AA442C5727BA06FA504E75EDBCB8AE8DDCC2A2DF05867286B35D83704988E5E293E4DA9A77713ADBA36F3A147291F8FA12A2B366B4142B6FCC7665F4E816E6475D89F74A5A5BE2775FF759749CED400925EAFF5AA50A3731A504AAE75887F1E7ACC45AC0DCF61B6B04E1C5AB1863CA517DAC05355DAE8CF61FB9CFC071B123DF17A4DC05DA306CA48C3B0743F0D584AD44A81C67AF9121CC64081DC5677957CC9D6EC5EA6FDB5845744AC5FD0A4894DFE3768402B19217BF2505E279A422AE8C52EF95DCBB5FB28D31FBDBA5EAC44AB7959CA4AF93B33CF7FE5B0EB33EB3BD3EFD0D315F1E6B23B246E40AE2E15AF6CA88AF269685EB88C8FA533C5B5B429058FF59DA29D896E925CCD3E9E65413DF3BF248DC03ADCECF605AD26F928448257EA7CB15DB637E8B6FE75779523DA789E31B11815C93E279A422BECBD97AFE8C27D7FCCC67A236624FA000EE2F2328590E923DEFE7604F0976EAAB682B39495FA7F0172BEBABF3589ACE6C3FBDB496FE64960F6269D090018D581A5481462C0DAA4023960655A0114B832AD088A5411568C4D2A00A34626950051AB134A8029E58AC269AE4535EBC7861FD2F21660113D9837A320000000049454E44AE426082\n\n^FO150,150\n^IMR:SAMPLE.PNG\n^XZ", output);
        }
    }
}
